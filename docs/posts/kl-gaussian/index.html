<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> 多変量正規分布間のKL距離 | Ryosuke Yoneda&#39;s Homepage</title>
  <meta name="description" content="Hugo is a general-purpose website framework. Technically speaking, Hugo is a static site generator. Unlike systems that dynamically build a page with each visitor request, Hugo builds pages when you create or update your content. Since websites are viewed far more often than they are edited, Hugo is designed to provide an optimal viewing experience for your website’s end users and an ideal writing experience for website authors.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="多変量正規分布間のKL距離" />
<meta property="og:description" content="確率分布の間の&quot;近さ&quot;を測る代表的なものとしてKL距離(Kullback–Leibler divergence)があります。特に多変量正規分布間のKL距離は変分下界を計算する際に登場することもあったりして応用上も重要です。その導出を行います。
準備 平均$\mu$、分散共分散行列$\Sigma$の$N$次元正規分布$\mathcal{N}(u\mid\mu,\Sigma)$の確率密度関数は $$ p(u)=\frac{1}{\sqrt{2\pi}^{N}\sqrt{| \Sigma |}}\exp\left[-\frac{1}{2}(u-\mu)^{\mathsf{T}}\Sigma^{-1}(u-\mu)\right] $$ で与えられます。 また、確率分布$q$に対する確率分布$p$のKL距離は $$ \text{KL}[p || q]=\int p(u)\log\frac{p(u)}{q(u)}du $$ で定義されます。
導出 2つの$N$次元正規分布$p(u)=\mathcal{N}(u \mid \mu _ {1},\Sigma _ {1}),q(u)=\mathcal{N}(u \mid \mu _ {2},\Sigma _ {2})$に対して$\text{KL}[p || q]$を計算します。 $\log$部分を展開すると、 $$ \log\frac{p(u)}{q(u)}=\frac{1}{2}\log\frac{|\Sigma _ {2}|}{|\Sigma _ {1}|} -\frac{1}{2}(u-\mu _ {1})^{\mathsf{T}}\Sigma _ {1}^{-1}(u-\mu _ {1}) &#43; \frac{1}{2}(u-\mu _ {2})^{\mathsf{T}}\Sigma _ {2}^{-1}(u-\mu _ {2}) $$ と3つにわかれるので $$ \begin{aligned} \text{KL}[p || q] = &amp;\frac{1}{2}\log\frac{|\Sigma _ {2}|}{|\Sigma _ {1}|}\int_{\mathbb{R}^{N}}p(u)du \\ &amp; - \frac{1}{2}\int_{\mathbb{R}^{N}}(u-\mu _ {1})^{\mathsf{T}}\Sigma _ {1}^{-1}(u-\mu _ {1})p(u)du \\ &amp; &#43; \frac{1}{2}\int_{\mathbb{R}^{N}}(u-\mu _ {2})^{\mathsf{T}}\Sigma _ {2}^{-1}(u-\mu _ {2}) p(u)du \end{aligned} $$ とできます。各行を計算していきます。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yonesuke.github.io/posts/kl-gaussian/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-19T00:32:17+09:00" />
<meta property="article:modified_time" content="2021-04-19T00:32:17+09:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="多変量正規分布間のKL距離"/>
<meta name="twitter:description" content="確率分布の間の&quot;近さ&quot;を測る代表的なものとしてKL距離(Kullback–Leibler divergence)があります。特に多変量正規分布間のKL距離は変分下界を計算する際に登場することもあったりして応用上も重要です。その導出を行います。
準備 平均$\mu$、分散共分散行列$\Sigma$の$N$次元正規分布$\mathcal{N}(u\mid\mu,\Sigma)$の確率密度関数は $$ p(u)=\frac{1}{\sqrt{2\pi}^{N}\sqrt{| \Sigma |}}\exp\left[-\frac{1}{2}(u-\mu)^{\mathsf{T}}\Sigma^{-1}(u-\mu)\right] $$ で与えられます。 また、確率分布$q$に対する確率分布$p$のKL距離は $$ \text{KL}[p || q]=\int p(u)\log\frac{p(u)}{q(u)}du $$ で定義されます。
導出 2つの$N$次元正規分布$p(u)=\mathcal{N}(u \mid \mu _ {1},\Sigma _ {1}),q(u)=\mathcal{N}(u \mid \mu _ {2},\Sigma _ {2})$に対して$\text{KL}[p || q]$を計算します。 $\log$部分を展開すると、 $$ \log\frac{p(u)}{q(u)}=\frac{1}{2}\log\frac{|\Sigma _ {2}|}{|\Sigma _ {1}|} -\frac{1}{2}(u-\mu _ {1})^{\mathsf{T}}\Sigma _ {1}^{-1}(u-\mu _ {1}) &#43; \frac{1}{2}(u-\mu _ {2})^{\mathsf{T}}\Sigma _ {2}^{-1}(u-\mu _ {2}) $$ と3つにわかれるので $$ \begin{aligned} \text{KL}[p || q] = &amp;\frac{1}{2}\log\frac{|\Sigma _ {2}|}{|\Sigma _ {1}|}\int_{\mathbb{R}^{N}}p(u)du \\ &amp; - \frac{1}{2}\int_{\mathbb{R}^{N}}(u-\mu _ {1})^{\mathsf{T}}\Sigma _ {1}^{-1}(u-\mu _ {1})p(u)du \\ &amp; &#43; \frac{1}{2}\int_{\mathbb{R}^{N}}(u-\mu _ {2})^{\mathsf{T}}\Sigma _ {2}^{-1}(u-\mu _ {2}) p(u)du \end{aligned} $$ とできます。各行を計算していきます。"/>

  
  
    
  
  
  <link rel="stylesheet" href="https://yonesuke.github.io/css/style-classic.css">
  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://yonesuke.github.io/images/favicon.ico" />

  
  
  
  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/about">About</a></li>
         
        <li><a href="/research">Research</a></li>
         
        <li><a href="/teaching">Teaching</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/cv.pdf">CV</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://yonesuke.github.io/posts/d1/">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://yonesuke.github.io/posts/stable_simulations/">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f&text=%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f&title=%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f&is_video=false&description=%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2&body=Check out this article: https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f&title=%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f&title=%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f&name=%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2&description=%e7%a2%ba%e7%8e%87%e5%88%86%e5%b8%83%e3%81%ae%e9%96%93%e3%81%ae%26quot%3b%e8%bf%91%e3%81%95%26quot%3b%e3%82%92%e6%b8%ac%e3%82%8b%e4%bb%a3%e8%a1%a8%e7%9a%84%e3%81%aa%e3%82%82%e3%81%ae%e3%81%a8%e3%81%97%e3%81%a6KL%e8%b7%9d%e9%9b%a2%28Kullback%e2%80%93Leibler%20divergence%29%e3%81%8c%e3%81%82%e3%82%8a%e3%81%be%e3%81%99%e3%80%82%e7%89%b9%e3%81%ab%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2%e3%81%af%e5%a4%89%e5%88%86%e4%b8%8b%e7%95%8c%e3%82%92%e8%a8%88%e7%ae%97%e3%81%99%e3%82%8b%e9%9a%9b%e3%81%ab%e7%99%bb%e5%a0%b4%e3%81%99%e3%82%8b%e3%81%93%e3%81%a8%e3%82%82%e3%81%82%e3%81%a3%e3%81%9f%e3%82%8a%e3%81%97%e3%81%a6%e5%bf%9c%e7%94%a8%e4%b8%8a%e3%82%82%e9%87%8d%e8%a6%81%e3%81%a7%e3%81%99%e3%80%82%e3%81%9d%e3%81%ae%e5%b0%8e%e5%87%ba%e3%82%92%e8%a1%8c%e3%81%84%e3%81%be%e3%81%99%e3%80%82%0a%e6%ba%96%e5%82%99%20%e5%b9%b3%e5%9d%87%24%5cmu%24%e3%80%81%e5%88%86%e6%95%a3%e5%85%b1%e5%88%86%e6%95%a3%e8%a1%8c%e5%88%97%24%5cSigma%24%e3%81%ae%24N%24%e6%ac%a1%e5%85%83%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%24%5cmathcal%7bN%7d%28u%5cmid%5cmu%2c%5cSigma%29%24%e3%81%ae%e7%a2%ba%e7%8e%87%e5%af%86%e5%ba%a6%e9%96%a2%e6%95%b0%e3%81%af%20%24%24%20p%28u%29%3d%5cfrac%7b1%7d%7b%5csqrt%7b2%5cpi%7d%5e%7bN%7d%5csqrt%7b%7c%20%5cSigma%20%7c%7d%7d%5cexp%5cleft%5b-%5cfrac%7b1%7d%7b2%7d%28u-%5cmu%29%5e%7b%5cmathsf%7bT%7d%7d%5cSigma%5e%7b-1%7d%28u-%5cmu%29%5cright%5d%20%24%24%20%e3%81%a7%e4%b8%8e%e3%81%88%e3%82%89%e3%82%8c%e3%81%be%e3%81%99%e3%80%82%20%e3%81%be%e3%81%9f%e3%80%81%e7%a2%ba%e7%8e%87%e5%88%86%e5%b8%83%24q%24%e3%81%ab%e5%af%be%e3%81%99%e3%82%8b%e7%a2%ba%e7%8e%87%e5%88%86%e5%b8%83%24p%24%e3%81%aeKL%e8%b7%9d%e9%9b%a2%e3%81%af%20%24%24%20%5ctext%7bKL%7d%5bp%20%7c%7c%20q%5d%3d%5cint%20p%28u%29%5clog%5cfrac%7bp%28u%29%7d%7bq%28u%29%7ddu%20%24%24%20%e3%81%a7%e5%ae%9a%e7%be%a9%e3%81%95%e3%82%8c%e3%81%be%e3%81%99%e3%80%82%0a%e5%b0%8e%e5%87%ba%202%e3%81%a4%e3%81%ae%24N%24%e6%ac%a1%e5%85%83%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%24p%28u%29%3d%5cmathcal%7bN%7d%28u%20%5cmid%20%5cmu%20_%20%7b1%7d%2c%5cSigma%20_%20%7b1%7d%29%2cq%28u%29%3d%5cmathcal%7bN%7d%28u%20%5cmid%20%5cmu%20_%20%7b2%7d%2c%5cSigma%20_%20%7b2%7d%29%24%e3%81%ab%e5%af%be%e3%81%97%e3%81%a6%24%5ctext%7bKL%7d%5bp%20%7c%7c%20q%5d%24%e3%82%92%e8%a8%88%e7%ae%97%e3%81%97%e3%81%be%e3%81%99%e3%80%82%20%24%5clog%24%e9%83%a8%e5%88%86%e3%82%92%e5%b1%95%e9%96%8b%e3%81%99%e3%82%8b%e3%81%a8%e3%80%81%20%24%24%20%5clog%5cfrac%7bp%28u%29%7d%7bq%28u%29%7d%3d%5cfrac%7b1%7d%7b2%7d%5clog%5cfrac%7b%7c%5cSigma%20_%20%7b2%7d%7c%7d%7b%7c%5cSigma%20_%20%7b1%7d%7c%7d%20-%5cfrac%7b1%7d%7b2%7d%28u-%5cmu%20_%20%7b1%7d%29%5e%7b%5cmathsf%7bT%7d%7d%5cSigma%20_%20%7b1%7d%5e%7b-1%7d%28u-%5cmu%20_%20%7b1%7d%29%20%2b%20%5cfrac%7b1%7d%7b2%7d%28u-%5cmu%20_%20%7b2%7d%29%5e%7b%5cmathsf%7bT%7d%7d%5cSigma%20_%20%7b2%7d%5e%7b-1%7d%28u-%5cmu%20_%20%7b2%7d%29%20%24%24%20%e3%81%a83%e3%81%a4%e3%81%ab%e3%82%8f%e3%81%8b%e3%82%8c%e3%82%8b%e3%81%ae%e3%81%a7%20%24%24%20%5cbegin%7baligned%7d%20%5ctext%7bKL%7d%5bp%20%7c%7c%20q%5d%20%3d%20%26amp%3b%5cfrac%7b1%7d%7b2%7d%5clog%5cfrac%7b%7c%5cSigma%20_%20%7b2%7d%7c%7d%7b%7c%5cSigma%20_%20%7b1%7d%7c%7d%5cint_%7b%5cmathbb%7bR%7d%5e%7bN%7d%7dp%28u%29du%20%5c%5c%20%26amp%3b%20-%20%5cfrac%7b1%7d%7b2%7d%5cint_%7b%5cmathbb%7bR%7d%5e%7bN%7d%7d%28u-%5cmu%20_%20%7b1%7d%29%5e%7b%5cmathsf%7bT%7d%7d%5cSigma%20_%20%7b1%7d%5e%7b-1%7d%28u-%5cmu%20_%20%7b1%7d%29p%28u%29du%20%5c%5c%20%26amp%3b%20%2b%20%5cfrac%7b1%7d%7b2%7d%5cint_%7b%5cmathbb%7bR%7d%5e%7bN%7d%7d%28u-%5cmu%20_%20%7b2%7d%29%5e%7b%5cmathsf%7bT%7d%7d%5cSigma%20_%20%7b2%7d%5e%7b-1%7d%28u-%5cmu%20_%20%7b2%7d%29%20p%28u%29du%20%5cend%7baligned%7d%20%24%24%20%e3%81%a8%e3%81%a7%e3%81%8d%e3%81%be%e3%81%99%e3%80%82%e5%90%84%e8%a1%8c%e3%82%92%e8%a8%88%e7%ae%97%e3%81%97%e3%81%a6%e3%81%84%e3%81%8d%e3%81%be%e3%81%99%e3%80%82">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f&t=%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    <div id="toc">
      <nav id="TableOfContents"></nav>
    </div>
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        多変量正規分布間のKL距離
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2021-04-19 00:32:17 &#43;0900 JST" itemprop="datePublished">2021-04-19</time>
          
        </div>
        
        
      </div>
    </header>


    <div class="content" itemprop="articleBody">
      <p>確率分布の間の&quot;近さ&quot;を測る代表的なものとしてKL距離(Kullback–Leibler divergence)があります。特に多変量正規分布間のKL距離は変分下界を計算する際に登場することもあったりして応用上も重要です。その導出を行います。</p>
<h1 id="準備">準備</h1>
<p>平均$\mu$、分散共分散行列$\Sigma$の$N$次元正規分布$\mathcal{N}(u\mid\mu,\Sigma)$の確率密度関数は
$$
p(u)=\frac{1}{\sqrt{2\pi}^{N}\sqrt{| \Sigma |}}\exp\left[-\frac{1}{2}(u-\mu)^{\mathsf{T}}\Sigma^{-1}(u-\mu)\right]
$$
で与えられます。
また、確率分布$q$に対する確率分布$p$のKL距離は
$$
\text{KL}[p || q]=\int p(u)\log\frac{p(u)}{q(u)}du
$$
で定義されます。</p>
<h1 id="導出">導出</h1>
<p>2つの$N$次元正規分布$p(u)=\mathcal{N}(u \mid \mu _ {1},\Sigma _ {1}),q(u)=\mathcal{N}(u \mid \mu _ {2},\Sigma _ {2})$に対して$\text{KL}[p || q]$を計算します。
$\log$部分を展開すると、
$$
\log\frac{p(u)}{q(u)}=\frac{1}{2}\log\frac{|\Sigma _ {2}|}{|\Sigma _ {1}|} -\frac{1}{2}(u-\mu _ {1})^{\mathsf{T}}\Sigma _ {1}^{-1}(u-\mu _ {1}) + \frac{1}{2}(u-\mu _ {2})^{\mathsf{T}}\Sigma _ {2}^{-1}(u-\mu _ {2})
$$
と3つにわかれるので
$$ \begin{aligned} \text{KL}[p || q] = &amp;\frac{1}{2}\log\frac{|\Sigma _ {2}|}{|\Sigma _ {1}|}\int_{\mathbb{R}^{N}}p(u)du \\ &amp; - \frac{1}{2}\int_{\mathbb{R}^{N}}(u-\mu _ {1})^{\mathsf{T}}\Sigma _ {1}^{-1}(u-\mu _ {1})p(u)du \\ &amp; + \frac{1}{2}\int_{\mathbb{R}^{N}}(u-\mu _ {2})^{\mathsf{T}}\Sigma _ {2}^{-1}(u-\mu _ {2}) p(u)du \end{aligned} $$
とできます。各行を計算していきます。</p>
<ul>
<li>
<p>一行目</p>
<p>これは簡単で
$$
\frac{1}{2}\log\frac{|\Sigma _ {2}|}{|\Sigma _ {1}|}\int_{\mathbb{R}^{N}}p(u)du=\frac{1}{2}\log\frac{|\Sigma _ {2}|}{|\Sigma _ {1}|}
$$
となります。</p>
</li>
<li>
<p>二行目</p>
<p>定数項を積分の外に出すと、
$$
-\frac{1}{2\sqrt{2\pi}^{N}\sqrt{| \Sigma _ {1}|}}\int _ {\mathbb{R}^{N}}\left[(u-\mu _ {1})^{\mathsf{T}}\Sigma _ {1}^{-1}(u-\mu _ {1})\right]\exp\left[-\frac{1}{2}(u-\mu _ {1})^{\mathsf{T}}\Sigma _ {1}^{-1}(u-\mu _ {1})\right]du
$$
となります。$v=u-\mu _ {1}$に平行移動すると、
$$
-\frac{1}{2\sqrt{2\pi}^{N}\sqrt{|\Sigma_{1}|}}\int _ {\mathbb{R}^{N}}\left(v^{\mathsf{T}}\Sigma _ {1}^{-1}v\right)\exp\left(-\frac{1}{2}v^{\mathsf{T}}\Sigma _ {1}^{-1}v\right)dv
$$
とかんたんにできて、更に$\Sigma _ {1}^{-1/2}v=w$と変数変換すると、
$$\begin{aligned} &amp;-\frac{1}{2\sqrt{2\pi}^{N}\sqrt{| \Sigma _ {1}|}}\int _ {\mathbb{R}^{N}}w^{\mathsf{T}}w \text{e}^{-w^{\mathsf{T}}w/2}\sqrt{|\Sigma _ {1}|} dw \\ = &amp;-\frac{1}{2\sqrt{2\pi}^{N}}\sum_{i=1}^{N}\int _ {\mathbb{R}^{N}}w _ {i}^{2}\text{e}^{-(w _ {1}^{2}+\dots+w _ {N})/2}dw _ {1}\dots dw _ {N}\end{aligned}$$
と展開できます。対称性から各$i$に対して値は同じなので、
$$\begin{aligned} -\frac{N}{2\sqrt{2\pi}^{N}}\int _ {\mathbb{R}^{N}}w_{1}^{2} \text{e}^{-(w_{1}^{2}+\dots+w_{N}^{2})/2}dw_{1}\cdots dw_{N} \end{aligned}$$
とできます。更に$w_{1}$とそれ以外について積分を分けると、
$$
\begin{aligned}
-\frac{N}{2\sqrt{2\pi}^{N}}\left(\int_{\mathbb{R}}w_{1}^{2}\text{e}^{-w_{1}^{2}/2}dw_{1}\right)\left(\int_{\mathbb{R}}\text{e}^{-w^{2}/2}dw\right)^{N-1}=-\frac{N}{2}
\end{aligned}
$$
とできます。</p>
</li>
<li>
<p>三行目</p>
<p>定数項を積分の外に出すと、
$$
\frac{1}{2\sqrt{2\pi}^{N}\sqrt{| \Sigma _ {1}|}}\int _ {\mathbb{R}^{N}}\left[(u-\mu _ {2})^{\mathsf{T}}\Sigma _ {2}^{-1}(u-\mu _ {2})\right]\exp\left[-\frac{1}{2}(u-\mu _ {1})^{\mathsf{T}}\Sigma _ {1}^{-1}(u-\mu _ {1})\right]du
$$
となります。$v=u-\mu_{1}$に平行移動すると、
$$\begin{aligned} &amp;\frac{1}{2\sqrt{2\pi}^{N}\sqrt{|\Sigma_{1}|}}\int_{\mathbb{R}^{N}}\left[(v-(\mu_{2}-\mu_{1}))^{\mathsf{T}}\Sigma_{2}^{-1}(v-(\mu_{2}-\mu_{1}))\right]\exp\left(-\frac{1}{2}v^{\mathsf{T}}\Sigma _ {1}^{-1}v\right)dv\\ =&amp;\frac{1}{2\sqrt{2\pi}^{N}\sqrt{|\Sigma_{1}|}}\int _ {\mathbb{R}^{N}}\left(v^{\mathsf{T}}\Sigma_{2}^{-1}v\right)\exp\left(-\frac{1}{2}v^{\mathsf{T}}\Sigma_{1}^{-1}v\right)dv\\&amp;-\frac{1}{\sqrt{2\pi}^{N}\sqrt{|\Sigma_{1}|}}\int _ {\mathbb{R}^{N}}\left((\mu_{2}-\mu_{1})^{\mathsf{T}}\Sigma_{2}^{-1}v\right)\exp\left(-\frac{1}{2}v^{\mathsf{T}}\Sigma_{1}^{-1}v\right)dv\\&amp;+\frac{(\mu_{2}-\mu_{1})^{\mathsf{T}}\Sigma_{2}^{-1}(\mu_{2}-\mu_{1})}{2\sqrt{2\pi}^{N}\sqrt{|\Sigma_{1}|}}\int_{\mathbb{R}^{N}}\exp\left(-\frac{1}{2}v^{\mathsf{T}}\Sigma _ {1}^{-1}v\right)dv \end{aligned}$$
とできます。</p>
<ul>
<li>
<p>一行目</p>
<p>$\Sigma _ {1}^{-1/2}v=w$と変数変換すると、
$$\frac{1}{2\sqrt{2\pi}^{N}}\int_{\mathbb{R}^{N}}\left(w^{\mathsf{T}}\Sigma_{1}^{1/2}\Sigma_{2}^{-1}\Sigma_{1}^{1/2}w\right)\text{e}^{-w^{\mathsf{T}}w/2}dw$$
となります。ここで$i\ne j$のとき、
$$
\int_{\mathbb{R}^{N}}w_{i}w_{j}\text{e}^{-w^{\mathsf{T}}w/2}dw=0
$$
であるから、上の計算は
$$\begin{aligned}&amp;\frac{1}{2\sqrt{2\pi}^{N}}\sum_{i=1}^{N}\int_{\mathbb{R}^{N}}\left[\Sigma_{1}^{1/2}\Sigma_{2}^{-1}\Sigma_{1}^{1/2}\right]<em>{i,i}w</em>{i}^{2}\text{e}^{-w^{\mathsf{T}}w/2}dw\\=&amp;\frac{\text{tr}\left(\Sigma_{1}^{1/2}\Sigma_{2}^{-1}\Sigma_{1}^{1/2}\right)}{2\sqrt{2\pi}^{N}}\int_{\mathbb{R}^{N}}w_{1}^{2}\text{e}^{-w^{\mathsf{T}}w/2}dw\end{aligned}$$
と簡単になって、上の二行目の計算を繰り返すと、
$$
\frac{1}{2}\text{tr}\left(\Sigma_{1}\Sigma_{2}^{-1}\right)
$$
が得られます。</p>
</li>
<li>
<p>二行目</p>
<p>これは$v$に関する奇関数になるので積分は$0$になります。</p>
</li>
<li>
<p>三行目</p>
<p>これは簡単で
$$
\frac{(\mu_{2}-\mu_{1})^{\mathsf{T}}\Sigma_{2}^{-1}(\mu_{2}-\mu_{1})}{2\sqrt{2\pi}^{N}\sqrt{|\Sigma_{1}|}}\int_{\mathbb{R}^{N}}\exp\left(-\frac{1}{2}v^{\mathsf{T}}\Sigma_{1}^{-1}v\right)dv
=\frac{1}{2}(\mu_{2}-\mu_{1})^{\mathsf{T}}\Sigma_{2}^{-1}(\mu_{2}-\mu_{1})
$$
です。</p>
</li>
</ul>
</li>
</ul>
<p>以上をまとめると、
$$
\text{KL}[p || q]=\frac{1}{2}\log\frac{|\Sigma_{2}|}{|\Sigma_{1}|}+\frac{1}{2}\text{tr}\left(\Sigma_{1}\Sigma_{2}^{-1}\right)+\frac{1}{2}(\mu_{2}-\mu_{1})^{\mathsf{T}}\Sigma_{2}^{-1}(\mu_{2}-\mu_{1})-\frac{N}{2}
$$
と求まりました。長い計算でした。</p>

    </div>
  </article>


  <script src="https://utteranc.es/client.js"
  repo="yonesuke/yonesuke.github.io"
  issue-term="pathname"
  theme="github-light"
  crossorigin="anonymous"
  async>
</script>

  
  





  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about">About</a></li>
         
          <li><a href="/research">Research</a></li>
         
          <li><a href="/teaching">Teaching</a></li>
         
          <li><a href="/posts">Posts</a></li>
         
          <li><a href="/cv.pdf">CV</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents"></nav>
    </div>

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f&text=%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f&title=%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f&is_video=false&description=%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2&body=Check out this article: https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f&title=%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f&title=%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f&name=%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2&description=%e7%a2%ba%e7%8e%87%e5%88%86%e5%b8%83%e3%81%ae%e9%96%93%e3%81%ae%26quot%3b%e8%bf%91%e3%81%95%26quot%3b%e3%82%92%e6%b8%ac%e3%82%8b%e4%bb%a3%e8%a1%a8%e7%9a%84%e3%81%aa%e3%82%82%e3%81%ae%e3%81%a8%e3%81%97%e3%81%a6KL%e8%b7%9d%e9%9b%a2%28Kullback%e2%80%93Leibler%20divergence%29%e3%81%8c%e3%81%82%e3%82%8a%e3%81%be%e3%81%99%e3%80%82%e7%89%b9%e3%81%ab%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2%e3%81%af%e5%a4%89%e5%88%86%e4%b8%8b%e7%95%8c%e3%82%92%e8%a8%88%e7%ae%97%e3%81%99%e3%82%8b%e9%9a%9b%e3%81%ab%e7%99%bb%e5%a0%b4%e3%81%99%e3%82%8b%e3%81%93%e3%81%a8%e3%82%82%e3%81%82%e3%81%a3%e3%81%9f%e3%82%8a%e3%81%97%e3%81%a6%e5%bf%9c%e7%94%a8%e4%b8%8a%e3%82%82%e9%87%8d%e8%a6%81%e3%81%a7%e3%81%99%e3%80%82%e3%81%9d%e3%81%ae%e5%b0%8e%e5%87%ba%e3%82%92%e8%a1%8c%e3%81%84%e3%81%be%e3%81%99%e3%80%82%0a%e6%ba%96%e5%82%99%20%e5%b9%b3%e5%9d%87%24%5cmu%24%e3%80%81%e5%88%86%e6%95%a3%e5%85%b1%e5%88%86%e6%95%a3%e8%a1%8c%e5%88%97%24%5cSigma%24%e3%81%ae%24N%24%e6%ac%a1%e5%85%83%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%24%5cmathcal%7bN%7d%28u%5cmid%5cmu%2c%5cSigma%29%24%e3%81%ae%e7%a2%ba%e7%8e%87%e5%af%86%e5%ba%a6%e9%96%a2%e6%95%b0%e3%81%af%20%24%24%20p%28u%29%3d%5cfrac%7b1%7d%7b%5csqrt%7b2%5cpi%7d%5e%7bN%7d%5csqrt%7b%7c%20%5cSigma%20%7c%7d%7d%5cexp%5cleft%5b-%5cfrac%7b1%7d%7b2%7d%28u-%5cmu%29%5e%7b%5cmathsf%7bT%7d%7d%5cSigma%5e%7b-1%7d%28u-%5cmu%29%5cright%5d%20%24%24%20%e3%81%a7%e4%b8%8e%e3%81%88%e3%82%89%e3%82%8c%e3%81%be%e3%81%99%e3%80%82%20%e3%81%be%e3%81%9f%e3%80%81%e7%a2%ba%e7%8e%87%e5%88%86%e5%b8%83%24q%24%e3%81%ab%e5%af%be%e3%81%99%e3%82%8b%e7%a2%ba%e7%8e%87%e5%88%86%e5%b8%83%24p%24%e3%81%aeKL%e8%b7%9d%e9%9b%a2%e3%81%af%20%24%24%20%5ctext%7bKL%7d%5bp%20%7c%7c%20q%5d%3d%5cint%20p%28u%29%5clog%5cfrac%7bp%28u%29%7d%7bq%28u%29%7ddu%20%24%24%20%e3%81%a7%e5%ae%9a%e7%be%a9%e3%81%95%e3%82%8c%e3%81%be%e3%81%99%e3%80%82%0a%e5%b0%8e%e5%87%ba%202%e3%81%a4%e3%81%ae%24N%24%e6%ac%a1%e5%85%83%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%24p%28u%29%3d%5cmathcal%7bN%7d%28u%20%5cmid%20%5cmu%20_%20%7b1%7d%2c%5cSigma%20_%20%7b1%7d%29%2cq%28u%29%3d%5cmathcal%7bN%7d%28u%20%5cmid%20%5cmu%20_%20%7b2%7d%2c%5cSigma%20_%20%7b2%7d%29%24%e3%81%ab%e5%af%be%e3%81%97%e3%81%a6%24%5ctext%7bKL%7d%5bp%20%7c%7c%20q%5d%24%e3%82%92%e8%a8%88%e7%ae%97%e3%81%97%e3%81%be%e3%81%99%e3%80%82%20%24%5clog%24%e9%83%a8%e5%88%86%e3%82%92%e5%b1%95%e9%96%8b%e3%81%99%e3%82%8b%e3%81%a8%e3%80%81%20%24%24%20%5clog%5cfrac%7bp%28u%29%7d%7bq%28u%29%7d%3d%5cfrac%7b1%7d%7b2%7d%5clog%5cfrac%7b%7c%5cSigma%20_%20%7b2%7d%7c%7d%7b%7c%5cSigma%20_%20%7b1%7d%7c%7d%20-%5cfrac%7b1%7d%7b2%7d%28u-%5cmu%20_%20%7b1%7d%29%5e%7b%5cmathsf%7bT%7d%7d%5cSigma%20_%20%7b1%7d%5e%7b-1%7d%28u-%5cmu%20_%20%7b1%7d%29%20%2b%20%5cfrac%7b1%7d%7b2%7d%28u-%5cmu%20_%20%7b2%7d%29%5e%7b%5cmathsf%7bT%7d%7d%5cSigma%20_%20%7b2%7d%5e%7b-1%7d%28u-%5cmu%20_%20%7b2%7d%29%20%24%24%20%e3%81%a83%e3%81%a4%e3%81%ab%e3%82%8f%e3%81%8b%e3%82%8c%e3%82%8b%e3%81%ae%e3%81%a7%20%24%24%20%5cbegin%7baligned%7d%20%5ctext%7bKL%7d%5bp%20%7c%7c%20q%5d%20%3d%20%26amp%3b%5cfrac%7b1%7d%7b2%7d%5clog%5cfrac%7b%7c%5cSigma%20_%20%7b2%7d%7c%7d%7b%7c%5cSigma%20_%20%7b1%7d%7c%7d%5cint_%7b%5cmathbb%7bR%7d%5e%7bN%7d%7dp%28u%29du%20%5c%5c%20%26amp%3b%20-%20%5cfrac%7b1%7d%7b2%7d%5cint_%7b%5cmathbb%7bR%7d%5e%7bN%7d%7d%28u-%5cmu%20_%20%7b1%7d%29%5e%7b%5cmathsf%7bT%7d%7d%5cSigma%20_%20%7b1%7d%5e%7b-1%7d%28u-%5cmu%20_%20%7b1%7d%29p%28u%29du%20%5c%5c%20%26amp%3b%20%2b%20%5cfrac%7b1%7d%7b2%7d%5cint_%7b%5cmathbb%7bR%7d%5e%7bN%7d%7d%28u-%5cmu%20_%20%7b2%7d%29%5e%7b%5cmathsf%7bT%7d%7d%5cSigma%20_%20%7b2%7d%5e%7b-1%7d%28u-%5cmu%20_%20%7b2%7d%29%20p%28u%29du%20%5cend%7baligned%7d%20%24%24%20%e3%81%a8%e3%81%a7%e3%81%8d%e3%81%be%e3%81%99%e3%80%82%e5%90%84%e8%a1%8c%e3%82%92%e8%a8%88%e7%ae%97%e3%81%97%e3%81%a6%e3%81%84%e3%81%8d%e3%81%be%e3%81%99%e3%80%82">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fyonesuke.github.io%2fposts%2fkl-gaussian%2f&t=%e5%a4%9a%e5%a4%89%e9%87%8f%e6%ad%a3%e8%a6%8f%e5%88%86%e5%b8%83%e9%96%93%e3%81%aeKL%e8%b7%9d%e9%9b%a2">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2022  Ryosuke Yoneda 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/about">About</a></li>
         
        <li><a href="/research">Research</a></li>
         
        <li><a href="/teaching">Teaching</a></li>
         
        <li><a href="/posts">Posts</a></li>
         
        <li><a href="/cv.pdf">CV</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.css" integrity="sha384-dbVIfZGuN1Yq7/1Ocstc1lUEm+AT+/rCkibIcC/OmWo5f0EA48Vf8CytHzGrSwbQ" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/katex.min.js" integrity="sha384-2BKqo+exmr9su6dir+qCw08N2ZKRucY4PrGQPPWU1A7FtlCGjmEGFqXCv5nyM5Ij" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {delimiters: [
      {left: "$$", right: "$$", display: true},
      {left: "$", right: "$", display: false}]
    });
  });
</script>

  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>



</html>
